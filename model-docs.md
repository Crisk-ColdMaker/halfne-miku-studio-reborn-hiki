# 模型配置说明

## 背景

小初音工作室Reborn的模型系统参考了Flash版本通过元件构造的模型结构

并且增加了一系列便于开发的特性，使得通用化的模型构建成为可能

在此基础上，提供了简单接入重力物理、连接件等基本能力的封装函数

便于完成原版模型的微调、素材变更、增加装饰物等修改

## 文件结构

小初音工作室Reborn的模型文件是一个单独的js脚本

当进行导入时，它会在一个带有一定上下文（也小初音工作室Reborn即提供的封装函数）的环境中被eval

输出结果应当为一个对象，小初音工作室Reborn中称之为Config，其内容的含义会在下面进行说明

你可以在本项目的`models`目录中找到可用于导入的两个模型文件以便参考

开发阶段你可以跑起本地环境之后通过直接修改`src/defaultModel.js`并刷新页面的方式快速进行迭代

最后将 `// COPY AREA START` 到 `// COPY AREA END` 之间的部分另存为一个js文件即可进行导入

## Config

### parseControl

函数类型。用于预处理引擎传入的原始控制数据（鼠标键盘等）。

在默认初音模型中，用于将鼠标输入转换为内部的一些角度值， 以及将键盘输入转换为当前的脸、口、眼状态。

默认值为`o=>o`，也即不进行任何处理。

#### 入参

入参只有一个，对象类型，定义为`{mouseX:Number, mouseY:Number, keyInput:any[], ...prevControl}`

mouseX和mouseY为当前时间的鼠标坐标

keyInput为当前时间的转换好的键盘输入列表（也即keyMapping中按键到ID的映射完成后的键盘输入）

录制回放时也是只进行上述原始控制数据的录制。

该对象的剩余部分为上一次这个函数运行时返回的`control`对象，这一特性允许你在每帧更新之间保留一些状态。

举个例子，按键切换眼睛类型后按键不会始终按下，但是眼睛类型需要继续保持，此时只要在这个函数中始终保持之前的`eyeType`不变即可

相反的，当不按任何按键时嘴型应该切换为闭嘴，所以在这个函数中会首先将`mouth`置为1，再处理`keyInput`中关于嘴型的输入

#### 返回值

返回值为处理好的`control`对象，会在之后处理`model`部分时使用到（没错，是便于你自己后续使用的）